"use strict";(()=>{var e={};e.id=940,e.ids=[940],e.modules={11185:e=>{e.exports=require("mongoose")},20399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},30517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},14300:e=>{e.exports=require("buffer")},32081:e=>{e.exports=require("child_process")},6113:e=>{e.exports=require("crypto")},82361:e=>{e.exports=require("events")},13685:e=>{e.exports=require("http")},95687:e=>{e.exports=require("https")},12781:e=>{e.exports=require("stream")},73837:e=>{e.exports=require("util")},43724:(e,t,r)=>{r.r(t),r.d(t,{originalPathname:()=>v,patchFetch:()=>b,requestAsyncStorage:()=>h,routeModule:()=>y,serverHooks:()=>f,staticGenerationAsyncStorage:()=>g});var n={};r.r(n),r.d(n,{POST:()=>m});var a=r(49303),s=r(88716),o=r(60670),i=r(87070),p=r(41482),u=r.n(p),l=r(2021),d=r(7998),c=r(69206);async function m(e){try{let t=e.cookies.get("auth-token")?.value;if(!t)return i.NextResponse.json({error:"Unauthorized"},{status:401});let r=u().verify(t,process.env.JWT_SECRET);await (0,l.Z)();let{jobId:n}=await e.json(),a=await d.Z.findById(n);if(!a)return i.NextResponse.json({error:"Job not found"},{status:404});if(a.postedBy.toString()!==r.userId)return i.NextResponse.json({error:"Unauthorized"},{status:401});if("escrow"!==a.paymentStatus)return i.NextResponse.json({error:"Payment is not in escrow"},{status:400});return await c.Z.paymentIntents.capture(a.paymentIntentId),await d.Z.findByIdAndUpdate(n,{paymentStatus:"released",status:"completed"}),i.NextResponse.json({message:"Payment released successfully"})}catch(e){return console.error("Error releasing payment:",e),i.NextResponse.json({error:"Error releasing payment"},{status:500})}}let y=new a.AppRouteRouteModule({definition:{kind:s.x.APP_ROUTE,page:"/api/payments/release/route",pathname:"/api/payments/release",filename:"route",bundlePath:"app/api/payments/release/route"},resolvedPagePath:"/Users/hunterricks/Downloads/stackblitz-starters-3acn8s (7)/app/api/payments/release/route.ts",nextConfigOutput:"",userland:n}),{requestAsyncStorage:h,staticGenerationAsyncStorage:g,serverHooks:f}=y,v="/api/payments/release/route";function b(){return(0,o.patchFetch)({serverHooks:f,staticGenerationAsyncStorage:g})}},2021:(e,t,r)=>{r.d(t,{Z:()=>i});var n=r(11185),a=r.n(n);if(!process.env.MONGODB_URI)throw Error("Please define the MONGODB_URI environment variable");let s=process.env.MONGODB_URI,o=global.mongooseCache;o||(o=global.mongooseCache={conn:null,promise:null});let i=async function(){if(o.conn)return o.conn;o.promise||(o.promise=a().connect(s,{bufferCommands:!1}).then(e=>e.connection));try{o.conn=await o.promise}catch(e){throw o.promise=null,e}return o.conn}},69206:(e,t,r)=>{r.d(t,{Z:()=>a});var n=r(48472);if(!process.env.STRIPE_SECRET_KEY)throw Error("STRIPE_SECRET_KEY is not set in the environment variables");let a=new n.Z(process.env.STRIPE_SECRET_KEY,{apiVersion:"2023-10-16",typescript:!0})},7998:(e,t,r)=>{r.d(t,{Z:()=>o});var n=r(11185),a=r.n(n);r(71732);let s=new(a()).Schema({title:{type:String,required:[!0,"Please provide a title for this job."],maxlength:[100,"Title cannot be more than 100 characters"]},description:{type:String,required:[!0,"Please provide a description for this job."],maxlength:[2e3,"Description cannot be more than 2000 characters"]},category:{type:String,required:[!0,"Please specify the category of this job."],enum:["renovation","plumbing","electrical","painting","landscaping","cleaning","other"]},location:{type:String,required:[!0,"Please specify the location for this job."]},budget:{type:Number,min:[0,"Budget cannot be negative"]},minHourlyRate:{type:Number,min:[0,"Hourly rate cannot be negative"]},maxHourlyRate:{type:Number,min:[0,"Hourly rate cannot be negative"]},budgetType:{type:String,enum:["fixed","hourly"],required:[!0,"Please specify the budget type."]},scope:{type:String,required:[!0,"Please specify the scope of this job."],enum:["small","medium","large"]},duration:{type:String,required:[!0,"Please specify the duration of this job."],enum:["1-3","3-6","6+"]},experienceLevel:{type:String,required:[!0,"Please specify the required experience level."],enum:["entry","intermediate","expert"]},skills:[{type:String,required:[!0,"Please specify at least one required skill."]}],postedBy:{type:a().Schema.Types.ObjectId,ref:"User",required:[!0,"Please provide the user who posted this job."]},status:{type:String,enum:["open","in_progress","completed","cancelled"],default:"open"},paymentStatus:{type:String,enum:["pending","escrow","released","refunded"],default:"pending"},createdAt:{type:Date,default:Date.now},updatedAt:{type:Date,default:Date.now}});s.pre("save",function(e){this.updatedAt=new Date,e()});let o=a().models.Job||a().model("Job",s)},71732:(e,t,r)=>{r.d(t,{Z:()=>o});var n=r(11185),a=r.n(n);let s=new(a()).Schema({name:{type:String,required:[!0,"Please provide a name"],maxlength:[60,"Name cannot be more than 60 characters"]},email:{type:String,required:[!0,"Please provide an email"],unique:!0,lowercase:!0,trim:!0},password:{type:String,required:[!0,"Please provide a password"],minlength:[8,"Password must be at least 8 characters long"]},fcmTokens:[{type:String}],createdAt:{type:Date,default:Date.now}}),o=a().models.User||a().model("User",s)}};var t=require("../../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),n=t.X(0,[9276,5972,1482,8472],()=>r(43724));module.exports=n})();