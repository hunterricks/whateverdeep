"use strict";(()=>{var e={};e.id=4204,e.ids=[4204],e.modules={11185:e=>{e.exports=require("mongoose")},20399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},30517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},44622:(e,t,r)=>{r.r(t),r.d(t,{originalPathname:()=>h,patchFetch:()=>f,requestAsyncStorage:()=>m,routeModule:()=>g,serverHooks:()=>b,staticGenerationAsyncStorage:()=>y});var o={};r.r(o),r.d(o,{GET:()=>c,POST:()=>u});var n=r(49303),a=r(88716),s=r(60670),i=r(87070),l=r(2021),p=r(7998);r(71732);var d=r(11185);async function u(e){try{await (0,l.Z)();let t=await e.json();for(let e of(console.log("Received job data:",t),["title","description","category","location","scope","experienceLevel","budgetType"]))if(!t[e])return i.NextResponse.json({error:`Missing required field: ${e}`},{status:400});let r={title:t.title,description:t.description,category:t.category,location:t.location,scope:t.scope,duration:t.duration,experienceLevel:t.experienceLevel,skills:t.skills,status:"open",paymentStatus:"pending",budgetType:t.budgetType,budget:void 0,minHourlyRate:void 0,maxHourlyRate:void 0};if("fixed"===t.budgetType)r.budget=t.budget;else{if("hourly"!==t.budgetType)return i.NextResponse.json({error:"Invalid budget type"},{status:400});r.minHourlyRate=t.minHourlyRate,r.maxHourlyRate=t.maxHourlyRate}if(!(t.postedBy&&d.Types.ObjectId.isValid(t.postedBy)))return i.NextResponse.json({error:"Invalid postedBy ID"},{status:400});r.postedBy=t.postedBy,console.log("Creating job with data:",r);let o=await p.Z.create(r);return console.log("New job created:",o._id),i.NextResponse.json(o,{status:201})}catch(e){if(console.error("Error creating job:",e),"ValidationError"===e.name)return i.NextResponse.json({error:"Validation error",details:e.errors},{status:400});return i.NextResponse.json({error:"Error creating job",message:e.message},{status:500})}}async function c(e){try{await (0,l.Z)();let{searchParams:t}=new URL(e.url),r=t.get("category"),o=t.get("location"),n=t.get("minBudget"),a=t.get("maxBudget"),s=t.get("status")||"open",d=t.get("sortBy")||"createdAt",u=t.get("sortOrder")||"desc",c={status:s};r&&(c.category=r),o&&(c.location={$regex:o,$options:"i"}),(n||a)&&(c.budget={},n&&(c.budget.$gte=parseInt(n)),a&&(c.budget.$lte=parseInt(a)));let g=await p.Z.find(c).sort({[d]:"desc"===u?-1:1}).populate("postedBy","name").lean();return i.NextResponse.json(g)}catch(e){return console.error("Error fetching jobs:",e),i.NextResponse.json({error:"Error fetching jobs"},{status:500})}}let g=new n.AppRouteRouteModule({definition:{kind:a.x.APP_ROUTE,page:"/api/jobs/route",pathname:"/api/jobs",filename:"route",bundlePath:"app/api/jobs/route"},resolvedPagePath:"/Users/hunterricks/Downloads/stackblitz-starters-3acn8s (7)/app/api/jobs/route.ts",nextConfigOutput:"",userland:o}),{requestAsyncStorage:m,staticGenerationAsyncStorage:y,serverHooks:b}=g,h="/api/jobs/route";function f(){return(0,s.patchFetch)({serverHooks:b,staticGenerationAsyncStorage:y})}},2021:(e,t,r)=>{r.d(t,{Z:()=>i});var o=r(11185),n=r.n(o);if(!process.env.MONGODB_URI)throw Error("Please define the MONGODB_URI environment variable");let a=process.env.MONGODB_URI,s=global.mongooseCache;s||(s=global.mongooseCache={conn:null,promise:null});let i=async function(){if(s.conn)return s.conn;s.promise||(s.promise=n().connect(a,{bufferCommands:!1}).then(e=>e.connection));try{s.conn=await s.promise}catch(e){throw s.promise=null,e}return s.conn}},7998:(e,t,r)=>{r.d(t,{Z:()=>s});var o=r(11185),n=r.n(o);r(71732);let a=new(n()).Schema({title:{type:String,required:[!0,"Please provide a title for this job."],maxlength:[100,"Title cannot be more than 100 characters"]},description:{type:String,required:[!0,"Please provide a description for this job."],maxlength:[2e3,"Description cannot be more than 2000 characters"]},category:{type:String,required:[!0,"Please specify the category of this job."],enum:["renovation","plumbing","electrical","painting","landscaping","cleaning","other"]},location:{type:String,required:[!0,"Please specify the location for this job."]},budget:{type:Number,min:[0,"Budget cannot be negative"]},minHourlyRate:{type:Number,min:[0,"Hourly rate cannot be negative"]},maxHourlyRate:{type:Number,min:[0,"Hourly rate cannot be negative"]},budgetType:{type:String,enum:["fixed","hourly"],required:[!0,"Please specify the budget type."]},scope:{type:String,required:[!0,"Please specify the scope of this job."],enum:["small","medium","large"]},duration:{type:String,required:[!0,"Please specify the duration of this job."],enum:["1-3","3-6","6+"]},experienceLevel:{type:String,required:[!0,"Please specify the required experience level."],enum:["entry","intermediate","expert"]},skills:[{type:String,required:[!0,"Please specify at least one required skill."]}],postedBy:{type:n().Schema.Types.ObjectId,ref:"User",required:[!0,"Please provide the user who posted this job."]},status:{type:String,enum:["open","in_progress","completed","cancelled"],default:"open"},paymentStatus:{type:String,enum:["pending","escrow","released","refunded"],default:"pending"},createdAt:{type:Date,default:Date.now},updatedAt:{type:Date,default:Date.now}});a.pre("save",function(e){this.updatedAt=new Date,e()});let s=n().models.Job||n().model("Job",a)},71732:(e,t,r)=>{r.d(t,{Z:()=>s});var o=r(11185),n=r.n(o);let a=new(n()).Schema({name:{type:String,required:[!0,"Please provide a name"],maxlength:[60,"Name cannot be more than 60 characters"]},email:{type:String,required:[!0,"Please provide an email"],unique:!0,lowercase:!0,trim:!0},password:{type:String,required:[!0,"Please provide a password"],minlength:[8,"Password must be at least 8 characters long"]},fcmTokens:[{type:String}],createdAt:{type:Date,default:Date.now}}),s=n().models.User||n().model("User",a)}};var t=require("../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),o=t.X(0,[9276,5972],()=>r(44622));module.exports=o})();