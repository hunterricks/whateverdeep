"use strict";(()=>{var e={};e.id=5854,e.ids=[5854],e.modules={11185:e=>{e.exports=require("mongoose")},20399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},30517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},14300:e=>{e.exports=require("buffer")},6113:e=>{e.exports=require("crypto")},12781:e=>{e.exports=require("stream")},73837:e=>{e.exports=require("util")},64777:(e,r,t)=>{t.r(r),t.d(r,{originalPathname:()=>b,patchFetch:()=>j,requestAsyncStorage:()=>y,routeModule:()=>g,serverHooks:()=>v,staticGenerationAsyncStorage:()=>f});var o={};t.r(o),t.d(o,{GET:()=>h,POST:()=>m});var a=t(49303),n=t(88716),s=t(60670),i=t(87070),p=t(41482),l=t.n(p),u=t(2021),d=t(46923),c=t(7998);async function m(e){try{let r=e.cookies.get("auth-token")?.value;if(!r)return i.NextResponse.json({error:"Unauthorized"},{status:401});let t=l().verify(r,process.env.JWT_SECRET);await (0,u.Z)();let o=await e.json(),a=await c.Z.findById(o.jobId);if(!a)return i.NextResponse.json({error:"Job not found"},{status:404});if("open"!==a.status)return i.NextResponse.json({error:"Job is no longer accepting proposals"},{status:400});if(await d.Z.findOne({job:o.jobId,serviceProvider:t.userId}))return i.NextResponse.json({error:"You have already submitted a proposal for this job"},{status:400});let n=await d.Z.create({...o,job:o.jobId,serviceProvider:t.userId,status:"pending",createdAt:new Date});return i.NextResponse.json(n,{status:201})}catch(e){return console.error("Error creating proposal:",e),i.NextResponse.json({error:"Error creating proposal"},{status:500})}}async function h(e){try{await (0,u.Z)();let{searchParams:r}=new URL(e.url),t=r.get("jobId"),o=r.get("serviceProvider"),a={};t&&(a.job=t),o&&(a.serviceProvider=o);let n=await d.Z.find(a).populate("job","title").populate("serviceProvider","name").sort({createdAt:-1});return i.NextResponse.json(n)}catch(e){return console.error("Error fetching proposals:",e),i.NextResponse.json({error:"Error fetching proposals"},{status:500})}}let g=new a.AppRouteRouteModule({definition:{kind:n.x.APP_ROUTE,page:"/api/proposals/route",pathname:"/api/proposals",filename:"route",bundlePath:"app/api/proposals/route"},resolvedPagePath:"/Users/hunterricks/Downloads/stackblitz-starters-3acn8s (7)/app/api/proposals/route.ts",nextConfigOutput:"",userland:o}),{requestAsyncStorage:y,staticGenerationAsyncStorage:f,serverHooks:v}=g,b="/api/proposals/route";function j(){return(0,s.patchFetch)({serverHooks:v,staticGenerationAsyncStorage:f})}},2021:(e,r,t)=>{t.d(r,{Z:()=>i});var o=t(11185),a=t.n(o);if(!process.env.MONGODB_URI)throw Error("Please define the MONGODB_URI environment variable");let n=process.env.MONGODB_URI,s=global.mongooseCache;s||(s=global.mongooseCache={conn:null,promise:null});let i=async function(){if(s.conn)return s.conn;s.promise||(s.promise=a().connect(n,{bufferCommands:!1}).then(e=>e.connection));try{s.conn=await s.promise}catch(e){throw s.promise=null,e}return s.conn}},7998:(e,r,t)=>{t.d(r,{Z:()=>s});var o=t(11185),a=t.n(o);t(71732);let n=new(a()).Schema({title:{type:String,required:[!0,"Please provide a title for this job."],maxlength:[100,"Title cannot be more than 100 characters"]},description:{type:String,required:[!0,"Please provide a description for this job."],maxlength:[2e3,"Description cannot be more than 2000 characters"]},category:{type:String,required:[!0,"Please specify the category of this job."],enum:["renovation","plumbing","electrical","painting","landscaping","cleaning","other"]},location:{type:String,required:[!0,"Please specify the location for this job."]},budget:{type:Number,min:[0,"Budget cannot be negative"]},minHourlyRate:{type:Number,min:[0,"Hourly rate cannot be negative"]},maxHourlyRate:{type:Number,min:[0,"Hourly rate cannot be negative"]},budgetType:{type:String,enum:["fixed","hourly"],required:[!0,"Please specify the budget type."]},scope:{type:String,required:[!0,"Please specify the scope of this job."],enum:["small","medium","large"]},duration:{type:String,required:[!0,"Please specify the duration of this job."],enum:["1-3","3-6","6+"]},experienceLevel:{type:String,required:[!0,"Please specify the required experience level."],enum:["entry","intermediate","expert"]},skills:[{type:String,required:[!0,"Please specify at least one required skill."]}],postedBy:{type:a().Schema.Types.ObjectId,ref:"User",required:[!0,"Please provide the user who posted this job."]},status:{type:String,enum:["open","in_progress","completed","cancelled"],default:"open"},paymentStatus:{type:String,enum:["pending","escrow","released","refunded"],default:"pending"},createdAt:{type:Date,default:Date.now},updatedAt:{type:Date,default:Date.now}});n.pre("save",function(e){this.updatedAt=new Date,e()});let s=a().models.Job||a().model("Job",n)},46923:(e,r,t)=>{t.d(r,{Z:()=>s});var o=t(11185),a=t.n(o);let n=new(a()).Schema({job:{type:a().Schema.Types.ObjectId,ref:"Job",required:[!0,"Please provide the job this proposal is for."]},serviceProvider:{type:a().Schema.Types.ObjectId,ref:"User",required:[!0,"Please provide the service provider submitting this proposal."]},coverLetter:{type:String,required:[!0,"Please provide a cover letter for this proposal."],maxlength:[1e3,"Cover letter cannot be more than 1000 characters"]},price:{type:Number,required:[!0,"Please provide a price for this proposal."]},estimatedDuration:{type:String,required:[!0,"Please provide an estimated duration for this job."]},status:{type:String,enum:["pending","accepted","rejected"],default:"pending"},createdAt:{type:Date,default:Date.now}}),s=a().models.Proposal||a().model("Proposal",n)},71732:(e,r,t)=>{t.d(r,{Z:()=>s});var o=t(11185),a=t.n(o);let n=new(a()).Schema({name:{type:String,required:[!0,"Please provide a name"],maxlength:[60,"Name cannot be more than 60 characters"]},email:{type:String,required:[!0,"Please provide an email"],unique:!0,lowercase:!0,trim:!0},password:{type:String,required:[!0,"Please provide a password"],minlength:[8,"Password must be at least 8 characters long"]},fcmTokens:[{type:String}],createdAt:{type:Date,default:Date.now}}),s=a().models.User||a().model("User",n)}};var r=require("../../../webpack-runtime.js");r.C(e);var t=e=>r(r.s=e),o=r.X(0,[9276,5972,1482],()=>t(64777));module.exports=o})();