(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[7712],{3070:function(e,r,t){Promise.resolve().then(t.bind(t,2972))},2972:function(e,r,t){"use strict";t.r(r),t.d(r,{default:function(){return _}});var s=t(7437),a=t(2265),n=t(5216),i=t(6463),l=t(6013),o=t(495),c=t(2447),d=t(7440);let u=c.fC,f=a.forwardRef((e,r)=>{let{className:t,...a}=e;return(0,s.jsx)(c.aV,{ref:r,className:(0,d.cn)("inline-flex h-10 items-center justify-center rounded-md bg-muted p-1 text-muted-foreground",t),...a})});f.displayName=c.aV.displayName;let m=a.forwardRef((e,r)=>{let{className:t,...a}=e;return(0,s.jsx)(c.xz,{ref:r,className:(0,d.cn)("inline-flex items-center justify-center whitespace-nowrap rounded-sm px-3 py-1.5 text-sm font-medium ring-offset-background transition-all focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 data-[state=active]:bg-background data-[state=active]:text-foreground data-[state=active]:shadow-sm",t),...a})});m.displayName=c.xz.displayName;let p=a.forwardRef((e,r)=>{let{className:t,...a}=e;return(0,s.jsx)(c.VY,{ref:r,className:(0,d.cn)("mt-2 ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2",t),...a})});p.displayName=c.VY.displayName;var h=t(4693),x=t(7776),v=t(7138),g=t(516),j=t(5236),b=t(8267);let N=0===(0,j.C6)().length?(0,j.ZF)({apiKey:"AIzaSyD58Kn-yvzewAT5_VYj4qi60SlQFrCOsdo",authDomain:"whateverappv1.firebaseapp.com",projectId:"whateverappv1",storageBucket:"whateverappv1.appspot.com",messagingSenderId:"84286156246",appId:"1:84286156246:web:9131aec5335928414c4877",databaseURL:"https://whateverappv1-default-rtdb.firebaseio.com/"}):(0,j.C6)()[0],y=(0,g.N8)(N);(0,b.KL)(N);var w=t(3102),R=t(23);let k=a.forwardRef((e,r)=>{let{className:t,children:a,...n}=e;return(0,s.jsxs)(R.fC,{ref:r,className:(0,d.cn)("relative overflow-hidden",t),...n,children:[(0,s.jsx)(R.l_,{className:"h-full w-full rounded-[inherit]",children:a}),(0,s.jsx)(C,{}),(0,s.jsx)(R.Ns,{})]})});k.displayName=R.fC.displayName;let C=a.forwardRef((e,r)=>{let{className:t,orientation:a="vertical",...n}=e;return(0,s.jsx)(R.gb,{ref:r,orientation:a,className:(0,d.cn)("flex touch-none select-none transition-colors","vertical"===a&&"h-full w-2.5 border-l border-l-transparent p-[1px]","horizontal"===a&&"h-2.5 flex-col border-t border-t-transparent p-[1px]",t),...n,children:(0,s.jsx)(R.q4,{className:"relative flex-1 rounded-full bg-border"})})});C.displayName=R.gb.displayName;var S=t(5781),A=t(2365),E=t(2092),z=t(994),I=t(1647);function P(e){let{jobId:r,otherUserId:t,otherUserName:i}=e,[l,c]=(0,a.useState)([]),[d,u]=(0,a.useState)(""),[f,m]=(0,a.useState)(!1),{user:p}=(0,n.a)();(0,a.useRef)(null);let h=(0,a.useRef)(null);(0,a.useEffect)(()=>{if(!(null==p?void 0:p.id))return;let e=[p.id,t].sort().join("_"),s=(0,g.iH)(y,"messages/".concat(r,"/").concat(e)),a=(0,g.IO)(s,(0,g.g2)("timestamp"));m(!0);let n=(0,g.jM)(a,e=>{let r=e.val();r&&c(Object.entries(r).map(e=>{let[r,t]=e;return{id:r,...t}})),m(!1)});return()=>{(0,g.S1)(s),n()}},[r,t,null==p?void 0:p.id]),(0,a.useEffect)(()=>{x()},[l]);let x=()=>{var e;null===(e=h.current)||void 0===e||e.scrollIntoView({behavior:"smooth"})},v=async()=>{if(!d.trim()||!(null==p?void 0:p.id)||f)return;let e=[p.id,t].sort().join("_"),s=(0,g.iH)(y,"messages/".concat(r,"/").concat(e));m(!0);try{await (0,g.VF)(s,{sender:p.id,senderName:p.name,content:d,timestamp:Date.now()}),u("")}catch(e){console.error("Error sending message:",e)}finally{m(!1)}};return p?(0,s.jsxs)("div",{className:"flex flex-col h-[700px]",children:[(0,s.jsx)(k,{className:"flex-grow px-4",children:(0,s.jsxs)("div",{className:"space-y-4 py-4",children:[l.map(e=>(0,s.jsx)("div",{className:"flex ".concat(e.sender===p.id?"justify-end":"justify-start"),children:(0,s.jsxs)("div",{className:"flex items-start space-x-2 max-w-[70%] ".concat(e.sender===p.id?"flex-row-reverse space-x-reverse":""),children:[(0,s.jsxs)(I.qE,{className:"h-8 w-8",children:[(0,s.jsx)(I.F$,{src:"https://api.dicebear.com/7.x/avataaars/svg?seed=".concat(e.senderName)}),(0,s.jsx)(I.Q5,{children:e.senderName[0]})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("div",{className:"rounded-lg px-4 py-2 ".concat(e.sender===p.id?"bg-primary text-primary-foreground":"bg-muted"),children:(0,s.jsx)("p",{className:"break-words",children:e.content})}),(0,s.jsx)("span",{className:"text-xs text-muted-foreground mt-1 block",children:(0,S.Q)(e.timestamp,{addSuffix:!0})})]})]})},e.id)),(0,s.jsx)("div",{ref:h})]})}),(0,s.jsx)("div",{className:"p-4 border-t",children:(0,s.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,s.jsx)(o.z,{variant:"ghost",size:"icon",className:"shrink-0",children:(0,s.jsx)(A.Z,{className:"h-5 w-5"})}),(0,s.jsx)(o.z,{variant:"ghost",size:"icon",className:"shrink-0",children:(0,s.jsx)(E.Z,{className:"h-5 w-5"})}),(0,s.jsx)(w.I,{value:d,onChange:e=>u(e.target.value),onKeyPress:e=>{"Enter"!==e.key||e.shiftKey||(e.preventDefault(),v())},placeholder:"Type a message...",disabled:f,className:"flex-grow"}),(0,s.jsx)(o.z,{onClick:v,disabled:f||!d.trim(),size:"icon",className:"shrink-0",children:(0,s.jsx)(z.Z,{className:"h-5 w-5"})})]})})]}):null}function _(){var e,r,t,c;let{id:d}=(0,i.useParams)(),{user:g,checkAuth:j}=(0,n.a)(),b=(0,i.useRouter)(),[N,y]=(0,a.useState)(null),[w,R]=(0,a.useState)(null),[k,C]=(0,a.useState)([]);(0,a.useEffect)(()=>{if(!j()){b.push("/login");return}d&&"string"==typeof d?(S(),(null==g?void 0:g.activeRole)==="contractor"?A():(null==g?void 0:g.activeRole)==="homeowner"&&E()):(x.Am.error("Invalid job ID"),b.push("/browse-jobs"))},[d,g,b,j]);let S=async()=>{try{let e=await fetch("/api/jobs/".concat(d));if(!e.ok)throw Error("Failed to fetch job details");let r=await e.json();y(r)}catch(e){x.Am.error("Error fetching job details")}},A=async()=>{try{let e=await fetch("/api/proposals?jobId=".concat(d,"&serviceProvider=").concat(null==g?void 0:g.id));if(!e.ok)throw Error("Failed to fetch proposal");let r=await e.json();r.length>0&&R(r[0])}catch(e){x.Am.error("Error fetching proposal")}},E=async()=>{try{let e=await fetch("/api/proposals?jobId=".concat(d));if(!e.ok)throw Error("Failed to fetch proposals");let r=await e.json();C(r)}catch(e){x.Am.error("Error fetching proposals")}},z=async e=>{try{if(!(await fetch("/api/proposals/".concat(e),{method:"PATCH",headers:{"Content-Type":"application/json"},body:JSON.stringify({status:"accepted"})})).ok)throw Error("Failed to accept proposal");x.Am.success("Proposal accepted successfully!"),S(),E()}catch(e){x.Am.error("Error accepting proposal")}},I=()=>(null==g?void 0:g.activeRole)==="homeowner"&&(null==N?void 0:N.postedBy)===g.id||(null==g?void 0:g.activeRole)==="contractor"&&(null==w?void 0:w.status)==="accepted";return N?(0,s.jsxs)("div",{className:"container mx-auto px-4 py-8",children:[(0,s.jsxs)("div",{className:"mb-8",children:[(0,s.jsx)("h1",{className:"text-3xl font-bold mb-2",children:N.title}),(0,s.jsx)("p",{className:"text-muted-foreground mb-4",children:N.description}),(0,s.jsxs)("div",{className:"flex flex-wrap gap-4",children:[(0,s.jsxs)(h.C,{variant:"outline",children:["Budget: $",N.budget]}),(0,s.jsxs)(h.C,{variant:"outline",children:["Location: ",N.location]}),(0,s.jsxs)(h.C,{variant:"outline",children:["Timeline: ",N.timeline]}),(0,s.jsx)(h.C,{children:N.status})]})]}),(0,s.jsxs)(u,{defaultValue:"details",className:"space-y-4",children:[(0,s.jsxs)(f,{children:[(0,s.jsx)(m,{value:"details",children:"Details"}),(null==g?void 0:g.activeRole)==="homeowner"&&(0,s.jsx)(m,{value:"proposals",children:"Proposals"}),I()&&(0,s.jsx)(m,{value:"messages",children:"Messages"})]}),(0,s.jsx)(p,{value:"details",children:(0,s.jsx)(l.Zb,{children:(0,s.jsxs)(l.aY,{className:"pt-6",children:[(null==g?void 0:g.activeRole)==="contractor"&&"open"===N.status&&!w&&(0,s.jsx)(o.z,{asChild:!0,children:(0,s.jsx)(v.default,{href:"/jobs/".concat(d,"/submit-proposal"),children:"Submit Proposal"})}),w&&(0,s.jsxs)("div",{className:"space-y-4",children:[(0,s.jsx)("h3",{className:"text-lg font-semibold",children:"Your Proposal"}),(0,s.jsx)(h.C,{className:"mb-4",children:w.status}),(0,s.jsx)("p",{className:"text-muted-foreground",children:w.coverLetter}),(0,s.jsxs)("div",{className:"flex gap-4",children:[(0,s.jsxs)("p",{children:[(0,s.jsx)("strong",{children:"Price:"})," $",w.price]}),(0,s.jsxs)("p",{children:[(0,s.jsx)("strong",{children:"Duration:"})," ",w.estimatedDuration]})]})]})]})})}),(null==g?void 0:g.activeRole)==="homeowner"&&(0,s.jsx)(p,{value:"proposals",children:(0,s.jsxs)(l.Zb,{children:[(0,s.jsx)(l.Ol,{children:(0,s.jsx)(l.ll,{children:"Submitted Proposals"})}),(0,s.jsx)(l.aY,{children:(0,s.jsxs)("div",{className:"space-y-6",children:[k.map(e=>(0,s.jsx)(l.Zb,{children:(0,s.jsxs)(l.aY,{className:"pt-6",children:[(0,s.jsxs)("div",{className:"flex justify-between items-start mb-4",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("h4",{className:"font-semibold",children:e.serviceProvider.name}),(0,s.jsx)(h.C,{className:"mt-1",children:e.status})]}),"pending"===e.status&&"open"===N.status&&(0,s.jsx)(o.z,{onClick:()=>z(e._id),children:"Accept Proposal"})]}),(0,s.jsx)("p",{className:"text-muted-foreground mb-4",children:e.coverLetter}),(0,s.jsxs)("div",{className:"flex gap-4",children:[(0,s.jsxs)("p",{children:[(0,s.jsx)("strong",{children:"Price:"})," $",e.price]}),(0,s.jsxs)("p",{children:[(0,s.jsx)("strong",{children:"Duration:"})," ",e.estimatedDuration]})]})]})},e._id)),0===k.length&&(0,s.jsx)("p",{className:"text-center text-muted-foreground py-4",children:"No proposals received yet"})]})})]})}),I()&&(0,s.jsx)(p,{value:"messages",children:(0,s.jsx)(l.Zb,{children:(0,s.jsx)(l.aY,{className:"p-0",children:(0,s.jsx)(P,{jobId:N._id,otherUserId:(null==g?void 0:g.activeRole)==="homeowner"?null!==(e=null==w?void 0:w.serviceProvider._id)&&void 0!==e?e:"":null!==(r=N.postedBy)&&void 0!==r?r:"",otherUserName:(null==g?void 0:g.activeRole)==="homeowner"?null!==(t=null==w?void 0:w.serviceProvider.name)&&void 0!==t?t:"Contractor":null!==(c=N.postedByName)&&void 0!==c?c:"Homeowner"})})})})]})]}):null}},1647:function(e,r,t){"use strict";t.d(r,{F$:function(){return o},Q5:function(){return c},qE:function(){return l}});var s=t(7437),a=t(2265),n=t(4458),i=t(7440);let l=a.forwardRef((e,r)=>{let{className:t,...a}=e;return(0,s.jsx)(n.fC,{ref:r,className:(0,i.cn)("relative flex h-10 w-10 shrink-0 overflow-hidden rounded-full",t),...a})});l.displayName=n.fC.displayName;let o=a.forwardRef((e,r)=>{let{className:t,...a}=e;return(0,s.jsx)(n.Ee,{ref:r,className:(0,i.cn)("aspect-square h-full w-full",t),...a})});o.displayName=n.Ee.displayName;let c=a.forwardRef((e,r)=>{let{className:t,...a}=e;return(0,s.jsx)(n.NY,{ref:r,className:(0,i.cn)("flex h-full w-full items-center justify-center rounded-full bg-muted",t),...a})});c.displayName=n.NY.displayName},4693:function(e,r,t){"use strict";t.d(r,{C:function(){return l}});var s=t(7437);t(2265);var a=t(2218),n=t(7440);let i=(0,a.j)("inline-flex items-center rounded-full border px-2.5 py-0.5 text-xs font-semibold transition-colors focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2",{variants:{variant:{default:"border-transparent bg-primary text-primary-foreground hover:bg-primary/80",secondary:"border-transparent bg-secondary text-secondary-foreground hover:bg-secondary/80",destructive:"border-transparent bg-destructive text-destructive-foreground hover:bg-destructive/80",outline:"text-foreground"}},defaultVariants:{variant:"default"}});function l(e){let{className:r,variant:t,...a}=e;return(0,s.jsx)("div",{className:(0,n.cn)(i({variant:t}),r),...a})}},495:function(e,r,t){"use strict";t.d(r,{z:function(){return c}});var s=t(7437),a=t(2265),n=t(1538),i=t(2218),l=t(7440);let o=(0,i.j)("inline-flex items-center justify-center whitespace-nowrap rounded-md text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50",{variants:{variant:{default:"bg-primary text-primary-foreground hover:bg-primary/90",destructive:"bg-destructive text-destructive-foreground hover:bg-destructive/90",outline:"border border-input bg-background hover:bg-accent hover:text-accent-foreground",secondary:"bg-secondary text-secondary-foreground hover:bg-secondary/80",ghost:"hover:bg-accent hover:text-accent-foreground",link:"text-primary underline-offset-4 hover:underline"},size:{default:"h-10 px-4 py-2",sm:"h-9 rounded-md px-3",lg:"h-11 rounded-md px-8",icon:"h-10 w-10"}},defaultVariants:{variant:"default",size:"default"}}),c=a.forwardRef((e,r)=>{let{className:t,variant:a,size:i,asChild:c=!1,...d}=e,u=c?n.g7:"button";return(0,s.jsx)(u,{className:(0,l.cn)(o({variant:a,size:i,className:t})),ref:r,...d})});c.displayName="Button"},6013:function(e,r,t){"use strict";t.d(r,{Ol:function(){return l},SZ:function(){return c},Zb:function(){return i},aY:function(){return d},eW:function(){return u},ll:function(){return o}});var s=t(7437),a=t(2265),n=t(7440);let i=a.forwardRef((e,r)=>{let{className:t,...a}=e;return(0,s.jsx)("div",{ref:r,className:(0,n.cn)("rounded-lg border bg-card text-card-foreground shadow-sm",t),...a})});i.displayName="Card";let l=a.forwardRef((e,r)=>{let{className:t,...a}=e;return(0,s.jsx)("div",{ref:r,className:(0,n.cn)("flex flex-col space-y-1.5 p-6",t),...a})});l.displayName="CardHeader";let o=a.forwardRef((e,r)=>{let{className:t,...a}=e;return(0,s.jsx)("h3",{ref:r,className:(0,n.cn)("text-2xl font-semibold leading-none tracking-tight",t),...a})});o.displayName="CardTitle";let c=a.forwardRef((e,r)=>{let{className:t,...a}=e;return(0,s.jsx)("p",{ref:r,className:(0,n.cn)("text-sm text-muted-foreground",t),...a})});c.displayName="CardDescription";let d=a.forwardRef((e,r)=>{let{className:t,...a}=e;return(0,s.jsx)("div",{ref:r,className:(0,n.cn)("p-6 pt-0",t),...a})});d.displayName="CardContent";let u=a.forwardRef((e,r)=>{let{className:t,...a}=e;return(0,s.jsx)("div",{ref:r,className:(0,n.cn)("flex items-center p-6 pt-0",t),...a})});u.displayName="CardFooter"},3102:function(e,r,t){"use strict";t.d(r,{I:function(){return i}});var s=t(7437),a=t(2265),n=t(7440);let i=a.forwardRef((e,r)=>{let{className:t,type:a,...i}=e;return(0,s.jsx)("input",{type:a,className:(0,n.cn)("flex h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background file:border-0 file:bg-transparent file:text-sm file:font-medium file:text-foreground placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50",t),ref:r,...i})});i.displayName="Input"},5216:function(e,r,t){"use strict";t.d(r,{a:function(){return c}});var s=t(9099),a=t(9291),n=t(6853),i=t(2649);let l=()=>!1,o=(0,s.Ue)()((0,a.tJ)(e=>({user:null,isAuthenticated:!1,login:r=>{let t=l()?["homeowner","contractor"]:r.roles,s=r.activeRole||t[0];r.token&&i.Z.set("auth-token",r.token,{expires:7,sameSite:"strict",secure:!0,path:"/"}),e({user:{...r,roles:t,activeRole:s},isAuthenticated:!0})},logout:()=>{i.Z.remove("auth-token",{path:"/"}),localStorage.removeItem("auth-storage"),sessionStorage.clear(),e({user:null,isAuthenticated:!1})},switchRole:r=>{e(e=>e.user&&e.user.roles.includes(r)?{...e,user:{...e.user,activeRole:r}}:e)},clearState:()=>{e({user:null,isAuthenticated:!1})}}),{name:"auth-storage",partialize:e=>({user:e.user,isAuthenticated:e.isAuthenticated})})),c=()=>{let{user:e,error:r,isLoading:t}=(0,n.aF)(),{user:s,isAuthenticated:a,login:c,logout:d,switchRole:u}=o();return{user:l()?s:e?{id:e.sub,name:e.name,email:e.email,roles:e["https://myapp.org/roles"]||["homeowner"],activeRole:e["https://myapp.org/activeRole"]||"homeowner"}:null,isAuthenticated:l()?a:!!e,isLoading:!l()&&t,error:l()?null:r,login:c,logout:d,switchRole:u,checkAuth:()=>{if(l()){let e=i.Z.get("auth-token"),r=a&&null!==s&&null!==e;return r||o.getState().clearState(),r}return r?(console.error("Auth0 error:",r),!1):!t&&null!==e}}}},7440:function(e,r,t){"use strict";t.d(r,{cn:function(){return n}});var s=t(4839),a=t(6164);function n(){for(var e=arguments.length,r=Array(e),t=0;t<e;t++)r[t]=arguments[t];return(0,a.m6)((0,s.W)(r))}}},function(e){e.O(0,[7481,2183,231,4314,6853,7776,9459,2971,7023,1744],function(){return e(e.s=3070)}),_N_E=e.O()}]);